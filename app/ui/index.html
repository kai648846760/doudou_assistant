<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DouDou Assistant - Douyin Crawler</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>DouDou Assistant</h1>
            <p class="subtitle">Douyin Data Crawler</p>
        </header>

        <nav class="tabs">
            <button class="tab-button" data-tab="login">Login</button>
            <button class="tab-button active" data-tab="crawl">Crawl</button>
            <button class="tab-button" data-tab="data">Data</button>
        </nav>

        <main class="content">
            <div id="login" class="tab-content">
                <h2>Login to Douyin</h2>
                <p>
                    To crawl Douyin profiles, you must be logged in. Click "Open Douyin" to open a browser window
                    where you can log in to your Douyin account. Your session will persist between runs and is stored
                    securely on your machine.
                </p>
                
                <div class="login-status-card" id="login-status-card">
                    <div class="status-indicator" id="status-indicator">
                        <span class="status-dot" id="status-dot"></span>
                        <span class="status-text" id="status-text">Checking login status...</span>
                    </div>
                    <div class="status-details" id="status-details"></div>
                </div>

                <div style="margin: 1.5rem 0;">
                    <button class="btn btn-primary" id="open-login-btn">Open Douyin</button>
                    <button class="btn btn-secondary" id="check-login-btn">Check Login Status</button>
                </div>
                
                <div class="info-box">
                    <strong>Note:</strong> The Douyin window uses a persistent profile stored in <code>./data/webview_profile</code>.
                    Login credentials and cookies remain local to your device.
                </div>
            </div>

            <div id="crawl" class="tab-content active">
                <h2>Crawl Data</h2>
                
                <div class="crawl-section">
                    <h3>Author Profile Crawler</h3>
                    <p>Enter an author profile URL, unique_id, or sec_uid to crawl all videos from that author.</p>
                    <div class="form-group">
                        <label for="author-url">Author Profile URL or ID:</label>
                        <input 
                            type="text" 
                            id="author-url" 
                            name="author-url" 
                            placeholder="https://www.douyin.com/user/MS4wLjA..."
                        >
                        <small>Examples: https://www.douyin.com/user/... or just the unique ID.</small>
                    </div>
                    <button class="btn btn-primary" id="start-author-btn">Start Author Crawl</button>
                </div>

                <div class="crawl-section" style="margin-top: 2rem;">
                    <h3>Video Crawler</h3>
                    <p>Enter a single video URL to crawl that video's details.</p>
                    <div class="form-group">
                        <label for="video-url">Video URL:</label>
                        <input 
                            type="text" 
                            id="video-url" 
                            name="video-url" 
                            placeholder="https://www.douyin.com/video/123456789"
                        >
                    </div>
                    <button class="btn btn-primary" id="start-video-btn">Start Video Crawl</button>
                </div>

                <div style="margin-top: 2rem;">
                    <button class="btn btn-secondary" id="stop-crawl-btn">Stop Crawl</button>
                    <button class="btn btn-secondary" id="mock-push-btn" style="margin-left: 0.5rem;">Test with Mock Data</button>
                </div>

                <div class="crawl-status-section">
                    <h3>Crawl Status</h3>
                    <div class="status-card" id="crawl-status-card">
                        <div class="status-row">
                            <span class="status-label">Status:</span>
                            <span class="status-value" id="crawl-status">Ready</span>
                        </div>
                        <div id="crawl-stats" class="stats-grid"></div>
                        <div id="error-display" class="error-message" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <div id="data" class="tab-content">
                <h2>Stored Data</h2>
                <div class="data-section">
                    <div class="filters">
                        <div class="form-group inline">
                            <label for="filter-author">Author</label>
                            <input type="text" id="filter-author" placeholder="Name, unique_id, or sec_uid">
                        </div>
                        <div class="form-group inline">
                            <label for="filter-from">From</label>
                            <input type="date" id="filter-from">
                        </div>
                        <div class="form-group inline">
                            <label for="filter-to">To</label>
                            <input type="date" id="filter-to">
                        </div>
                        <div class="filter-actions">
                            <button class="btn btn-secondary" id="apply-filters-btn">Apply Filters</button>
                            <button class="btn btn-link" id="reset-filters-btn">Reset</button>
                        </div>
                    </div>

                    <div class="data-actions">
                        <button class="btn btn-primary" id="refresh-data-btn">Refresh</button>
                        <button class="btn btn-secondary" id="export-csv-btn">Export to CSV</button>
                    </div>
                    
                    <div class="table-info">
                        <p id="table-summary">Loading...</p>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Aweme ID</th>
                                    <th>Author</th>
                                    <th>Description</th>
                                    <th>Date</th>
                                    <th>Duration</th>
                                    <th>Likes</th>
                                    <th>Comments</th>
                                    <th>Shares</th>
                                    <th>Plays</th>
                                    <th>Collects</th>
                                    <th>Music</th>
                                </tr>
                            </thead>
                            <tbody id="data-tbody">
                                <tr>
                                    <td colspan="11" class="empty-state">No records found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination" id="pagination" style="margin-top: 1rem;">
                        <button class="btn btn-sm" id="prev-page-btn" disabled>Previous</button>
                        <span id="page-info" style="margin: 0 1rem;">Page 1</span>
                        <button class="btn btn-sm" id="next-page-btn" disabled>Next</button>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p id="message">Loading...</p>
        </footer>
    </div>
    
    <script src="app.js"></script>
</body>
</html>
